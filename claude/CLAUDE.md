# CLAUDE.md

このファイルは、Claude Code がすべてのプロジェクトで作業する際のグローバルガイダンスを提供します。

## 作業開始前の確認

- **ブランチ確認**: 作業対象ブランチを事前に確認し、ユーザーの合意を取ってから着手する
- **プラン共有と承認**: 大きなタスクは細分化して説明し、OKをもらってから実行する
- **進捗の共有**: 標準フローのどこにいるかをこまめに共有し、次へ進む前に合意を得る
- **未確定事項の管理**: 仕様が曖昧な点はTODOやメモとして残す
- **コミットの粒度**: コミットは各タスクごとに後でリバートしやすい単位で細かく作成する

## 段階的なコミット戦略

**原則**: 1つのタスクが完了したら、次のタスクに移る前に必ずコミットする。

### なぜ細かくコミットするのか

1. **リバートの容易性**: 問題が発生した際、特定のタスクだけを取り消せる
2. **レビューの明確性**: 各変更の意図が明確になり、レビュワーが理解しやすい
3. **デバッグの効率化**: どのコミットで問題が発生したか特定しやすい

### コミットしてはいけないタイミング

- ビルドエラーがある状態
- 中途半端な実装（例: 型定義だけ変更してコンポーネントは未更新）
- テストが失敗している状態（テストを書いている場合）

ただし、**関連する複数ファイルの変更は1つのコミットにまとめる**こともあります：

```bash
# 型定義変更 + それに伴う全コンポーネントの更新を1コミット
git add src/types.ts src/components/*.tsx
git commit -m "Repayment型からIDを削除しユーザーオブジェクトに変更"
```

## PRの作成

### PR作成チェックリスト

- [ ] **issueの確認**: issue番号またはチケット番号を取得
- [ ] **PRタイトル**: `[XXX-xxx] 簡潔な変更内容の説明` 形式
- [ ] **PR本文**: 背景・実施内容を明確に記載
- [ ] **ローカル確認**: 動作確認済み、コンパイルエラーなし

### PR本文のフォーマット

```markdown
# 背景

（なぜこの変更が必要だったのか、どんな課題があったのかを記載）

# 原因 (バグ修正の場合)

（バグ修正の場合のみ記載。何が原因でバグが発生していたのかを説明）

# 実施内容

（具体的に何を実装・修正したのかを記載。複数ある場合は番号付きリストで整理）

# 備考 (あれば)

（レビュワーに伝えておきたい補足情報や注意点があれば記載）
```

**注**: issueをクローズする場合は、本文の先頭に `closed #xxx` を追加する。

### gh CLIを使用したPR作成

```bash
gh pr create --title "[XXX-xxx] 機能の説明" --body "$(cat <<'EOF'
# 背景

（背景を記載）

# 実施内容

1. （実施内容を記載）
2. （実施内容を記載）

EOF
)"
```

### PR作成手順

1. フィーチャーブランチをプッシュ: `git push -u origin feature/branch-name`
2. 詳細な説明付きでPRを作成
3. PR説明にissue/チケットをリンク（該当する場合）
4. レビュアーをアサイン（必要に応じて）
